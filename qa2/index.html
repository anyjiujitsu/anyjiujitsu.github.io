<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- EXACT same viewport as index (6).html -->
  <meta name="viewport" content="width=1200, initial-scale=0.32, maximum-scale=0.32, user-scalable=no, viewport-fit=cover" />

  <title>ANY N.E. - Directory</title>

  <style>
    /* === MATCH index (6).html global scale === */
    html { font-size: 22px; }

    :root{
      --green: #234c31;
      --bg: #ebebeb;
      --row: #e2e4e4;
      --shadow: rgba(0,0,0,0.18);
      --shadow2: rgba(0,0,0,0.10);
      --radius: 4px;

      /* index uses this gutter pattern */
      --left-gutter: 28px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color:#111;
    }

    /* === Fixture (same approach as index (6).html) === */
    @font-face{
      font-family: 'Fixture';
      src: local('Fixture'), local('Fixture Display'), local('Fixture Condensed');
      font-style: normal;
      font-weight: 400 900;
    }

    .wrap{
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      padding: 0px 28px 0px;
    }

    /* === TOP (copied structure from index (6).html) === */
    .top{
      position: relative;
      z-index: 60;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 16px;

      /* this overlap is part of the EVENTS look */
      margin-bottom: -80px;
    }

    .title{
      padding-left: var(--left-gutter);

      font-family: 'Fixture', Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
      font-size: 72px;
      letter-spacing: -0.04em;
      font-weight: 900;
      color: var(--green);
      margin: 0;
      text-transform: uppercase;
      line-height: 0.86;
      white-space: nowrap;
    }

    /* === ANY logo block (kept independent like EVENTS page) === */
    .any-logo{
      display:flex;
      align-items:center;
      justify-content:center;
      width: 130px;
      height: 96px;
      margin-right: 6px;
      transform: translateY(68px); /* matches the “logo moved down” tuning in index comments */
    }
    .any-logo img{
      width: 100%;
      height: auto;
      display:block;
    }

    /* === STICKY GREEN BAR (copied behavior from index) === */
    .sticky-head{
      position: sticky;
      top: 0;
      z-index: 40;
      background: var(--green);
      box-shadow: 0 4px 10px rgba(0,0,0,0.10);
      padding: 12px 0;
    }

    .head-inner{
      max-width: 100%;
      margin: 0 auto;
      padding: 0 28px;
      display:flex;
      align-items:center;
      gap: 16px;
      position: relative;
      z-index: 40;
    }

    /* Search pill (match EVENTS proportions) */
    .head-search{
      flex: 0 0 auto;
      width: 520px;
      max-width: 520px;
    }
    .search-pill{
      height: 44px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.16);
      box-shadow: 0 2px 10px rgba(0,0,0,0.10);
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 0 12px;
    }
    .search-icon{
      width: 18px;
      height: 18px;
      opacity: .55;
      flex: 0 0 auto;
    }
    #searchInput{
      width: 100%;
      border: 0;
      outline: none;
      background: transparent;
      font-size: 18px;
      color: #222;
    }
    #searchInput::placeholder{ color: rgba(0,0,0,0.45); }

    #searchClear{
      border:0;
      background: transparent;
      font-size: 26px;
      line-height: 1;
      padding: 0 6px;
      cursor: pointer;
      opacity: .55;
    }
    #searchClear:hover{ opacity: .8; }

    /* Pills row (visual-only right now) */
    .pill-row{
      flex: 1 1 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 14px;
    }
    .pill{
      height: 44px;
      min-width: 190px;
      padding: 0 18px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.16);
      box-shadow: 0 2px 10px rgba(0,0,0,0.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      user-select:none;
      cursor: default;
      color: rgba(0,0,0,0.45);
      font-weight: 600;
      font-size: 20px;
    }
    .pill .caret{
      font-size: 18px;
      color: rgba(0,0,0,.35);
      transform: translateY(1px);
    }

    /* === TABLE (keep your directory layout) === */
    .table-wrap{
      padding: 18px 28px 40px;
    }
    table{
      width: 100%;
      border-collapse: collapse;
      background: #f0f0f0;
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
    }
    thead th{
      text-align: left;
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(0,0,0,0.55);
      padding: 12px 14px;
      border-bottom: 1px solid rgba(0,0,0,0.10);
      background: #ededed;
    }
    tbody td{
      padding: 14px;
      border-top: 1px solid rgba(0,0,0,0.10);
      vertical-align: top;
      background: #e9e9e9;
    }

    .stack{
      display:flex;
      flex-direction:column;
      line-height:1.15;
      gap: 3px;
    }
    .primary{
      font-weight: 700;
      font-size: 13px;
      color:#111;
    }
    .secondary{
      font-size: 11px;
      color: rgba(0,0,0,0.55);
    }

    .satSunRow{
      display:flex;
      align-items:flex-start;
      gap: 10px;
    }
    .dayLabelCol{
      width: 34px;
      flex: 0 0 34px;
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .dayLabel{
      font-weight: 800;
      color:#111;
      font-size: 13px;
    }
    .timeCol{
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .timeVal{
      font-weight: 600;
      color: rgba(0,0,0,0.55);
      font-size: 13px;
      min-height: 16px;
    }

    .otaCell{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 10px;
      padding-top: 6px;
    }
    .otaLabel{
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(0,0,0,0.55);
      font-weight: 800;
    }
    .dot{
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #bdbdbd;
      border: 1px solid rgba(0,0,0,0.18);
    }
    .dot.y{ background: #19b56b; border-color: rgba(0,0,0,0.10); }
    .dot.n{ background: #d84b4b; border-color: rgba(0,0,0,0.10); }

    .error{
      color:#b40000;
      font-weight: 700;
      padding: 12px 14px;
    }
  </style>
</head>

<body>
  <!-- TITLE ROW -->
  <div class="wrap">
    <div class="top">
      <!-- iteration marker -->
      <h1 class="title">DIRECTORY10</h1>

      <!-- ANY (use your real asset here if you have it; this is just a safe placeholder) -->
      <div class="any-logo" aria-label="ANY logo">
        <img
          alt="ANY"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 240 140'%3E%3Crect x='8' y='12' width='224' height='116' rx='34' ry='34' fill='none' stroke='%23234c31' stroke-width='6'/%3E%3Ctext x='120' y='92' text-anchor='middle' font-family='Fixture, Impact, Arial Narrow, sans-serif' font-size='72' font-weight='900' fill='%23234c31'%3EANY%3C/text%3E%3C/svg%3E"
        />
      </div>
    </div>
  </div>

  <!-- GREEN BAR -->
  <div class="sticky-head">
    <div class="head-inner">
      <div class="head-search">
        <div class="search-pill" role="search">
          <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M10 18a8 8 0 1 1 5.293-14.02A8 8 0 0 1 10 18Zm11.707 2.293-5.386-5.386a9.5 9.5 0 1 0-1.414 1.414l5.386 5.386a1 1 0 0 0 1.414-1.414Z"/>
          </svg>
          <input id="searchInput" type="text" autocomplete="off" spellcheck="false"
                 placeholder='Filter (e.g., "boston", "ma", "10:00 AM")' />
          <button id="searchClear" type="button" aria-label="Clear filter" title="Clear">×</button>
        </div>
      </div>

      <div class="pill-row" aria-hidden="true">
        <div class="pill"><span>Events</span><span class="caret">▾</span></div>
        <div class="pill" style="min-width:170px;"><span>Years</span><span class="caret">▾</span></div>
        <div class="pill" style="min-width:170px;"><span>States</span><span class="caret">▾</span></div>
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th style="width:44%;">NAME / IG</th>
          <th style="width:22%;">CITY / STATE</th>
          <th style="width:22%;">SAT / SUN</th>
          <th style="width:12%;">OTA</th>
        </tr>
      </thead>
      <tbody id="rowsBody">
        <tr><td class="error" colspan="4">Loading…</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    const rowsBody = document.getElementById("rowsBody");
    const searchInput = document.getElementById("searchInput");
    const searchClear = document.getElementById("searchClear");

    // IMPORTANT: try multiple locations so /qa2/ works even if /data is at site root
    const CSV_CANDIDATES = [
      "/data/directory.csv",        // site root (works on GitHub Pages even from /qa2/)
      "./data/directory.csv",       // same folder as this page
      "data/directory.csv",         // relative
      "../data/directory.csv"       // one level up (common in /qa2/ setups)
    ];

    function toProper(str){
      const s = (str ?? "").toString().trim();
      if(!s) return "";
      return s
        .toLowerCase()
        .split(/(\s+|[-/])/g)
        .map(part => {
          if (part.trim() === "" || part === "-" || part === "/") return part;
          return part.charAt(0).toUpperCase() + part.slice(1);
        })
        .join("");
    }
    function toLowerSafe(str){ return (str ?? "").toString().trim().toLowerCase(); }

    function normalizeTime(t){
      const raw = (t ?? "").toString().trim();
      if(!raw) return "";
      const up = raw.replace(/\s+/g, " ").trim().toUpperCase();

      if (/^\d{1,2}:\d{2}\s?(AM|PM)$/.test(up)) return up.replace(/\s+/g," ").trim();

      const m = up.match(/^(\d{1,2})(?::(\d{2}))?\s*(A|P)M?$/);
      if(!m) return up;

      let hh = parseInt(m[1], 10);
      let mm = m[2] ? parseInt(m[2], 10) : 0;
      const ap = m[3] === "A" ? "AM" : "PM";

      if (Number.isNaN(hh) || hh < 1 || hh > 12) return up;
      if (Number.isNaN(mm) || mm < 0 || mm > 59) mm = 0;

      return `${hh}:${String(mm).padStart(2,"0")} ${ap}`;
    }

    function escapeHTML(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function parseCSV(text){
      const rows = [];
      let cur = [];
      let val = "";
      let inQuotes = false;

      for (let i = 0; i < text.length; i++){
        const ch = text[i];
        const next = text[i+1];

        if (ch === '"'){
          if (inQuotes && next === '"'){ val += '"'; i++; }
          else inQuotes = !inQuotes;
          continue;
        }

        if (!inQuotes && (ch === "," || ch === "\n" || ch === "\r")){
          cur.push(val);
          val = "";

          if (ch === "\n" || ch === "\r"){
            if (ch === "\r" && next === "\n") i++;
            if (cur.length > 1 || cur.some(c => (c ?? "").trim() !== "")) rows.push(cur);
            cur = [];
          }
          continue;
        }

        val += ch;
      }
      cur.push(val);
      if (cur.length) rows.push(cur);
      return rows;
    }

    let allRows = [];

    function render(rows){
      if(!rows.length){
        rowsBody.innerHTML = `<tr><td class="error" colspan="4">No rows found.</td></tr>`;
        return;
      }

      rowsBody.innerHTML = rows.map(r => {
        const name = toProper(r.NAME);
        const ig = toLowerSafe(r.IG);
        const city = toProper(r.CITY);
        const state = toProper(r.STATE);
        const sat = normalizeTime(r.SAT);
        const sun = normalizeTime(r.SUN);

        const ota = (r.OTA ?? "").toString().trim().toUpperCase(); // Y / N / blank
        const dotClass = ota === "Y" ? "y" : (ota === "N" ? "n" : "");

        return `
          <tr>
            <td>
              <div class="stack">
                <div class="primary">${escapeHTML(name)}</div>
                <div class="secondary">${escapeHTML(ig)}</div>
              </div>
            </td>
            <td>
              <div class="stack">
                <div class="primary">${escapeHTML(city)}</div>
                <div class="secondary">${escapeHTML(state)}</div>
              </div>
            </td>
            <td>
              <div class="satSunRow">
                <div class="dayLabelCol">
                  <div class="dayLabel">Sat.</div>
                  <div class="dayLabel">Sun.</div>
                </div>
                <div class="timeCol">
                  <div class="timeVal">${escapeHTML(sat)}</div>
                  <div class="timeVal">${escapeHTML(sun)}</div>
                </div>
              </div>
            </td>
            <td>
              <div class="otaCell">
                <div class="otaLabel">OTA</div>
                <div class="dot ${dotClass}"></div>
              </div>
            </td>
          </tr>
        `;
      }).join("");
    }

    function applySearch(){
      const q = (searchInput.value ?? "").toString().trim().toLowerCase();
      if(!q){ render(allRows); return; }
      const filtered = allRows.filter(r => {
        const blob = [
          r.STATE, r.CITY, r.NAME, r.IG, r.SAT, r.SUN, r.OTA, r.CREATED
        ].map(x => (x ?? "").toString().toLowerCase()).join(" ");
        return blob.includes(q);
      });
      render(filtered);
    }

    searchInput.addEventListener("input", applySearch);
    searchClear.addEventListener("click", () => {
      searchInput.value = "";
      applySearch();
      searchInput.focus();
    });

    async function fetchFirst(urls){
      let lastErr = null;
      for(const u of urls){
        try{
          const res = await fetch(u, { cache: "no-store" });
          if(!res.ok) throw new Error(`${u} (${res.status})`);
          const txt = await res.text();
          if (txt.trim()) return txt;
        }catch(e){ lastErr = e; }
      }
      throw lastErr || new Error("Failed to load CSV");
    }

    (async function init(){
      try{
        const text = await fetchFirst(CSV_CANDIDATES);
        const parsed = parseCSV(text);

        const header = parsed.shift().map(h => (h ?? "").toString().trim().toUpperCase());
        const idx = (name) => header.indexOf(name);

        allRows = parsed.map(cols => {
          const get = (h) => {
            const i = idx(h);
            return i >= 0 ? (cols[i] ?? "").toString().trim() : "";
          };
          return {
            STATE: get("STATE"),
            CITY: get("CITY"),
            NAME: get("NAME"),
            IG: get("IG"),
            SAT: get("SAT"),
            SUN: get("SUN"),
            OTA: get("OTA"),
            CREATED: get("CREATED")
          };
        });

        render(allRows);
      }catch(err){
        rowsBody.innerHTML = `<tr><td class="error" colspan="4">Failed to load directory.csv — tried: ${escapeHTML(CSV_CANDIDATES.join(", "))}</td></tr>`;
      }
    })();
  </script>
</body>
</html>
