<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1200, initial-scale=0.32, maximum-scale=0.32, user-scalable=no, viewport-fit=cover" />
  <title>ANY N.E. - Directory</title>

  <style>
    /* === Match EVENTS page global scaling behavior === */
    html { font-size: 22px; }

    :root{
      --green: #234c31;
      --bg: #ebebeb;
      --row: #e2e4e4;
      --shadow: rgba(0,0,0,0.18);
      --shadow2: rgba(0,0,0,0.10);
      --radius: 4px;

      /* EVENTS file uses these alignment tokens */
      --left-gutter: 28px;
      --table-start: 64px; /* visual left edge of table content (matches EVENTS tuning) */
    }

    * { box-sizing: border-box; }
    body{
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: #111;
    }

    /* Fixture (same approach as index (6).html) */
    @font-face{
      font-family: 'Fixture';
      src: local('Fixture'), local('Fixture Display'), local('Fixture Condensed');
      font-weight: 400 900;
      font-style: normal;
    }

    .wrap{
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      padding: 0px 28px 0px;
    }

    /* === TOP TITLE ROW (match EVENTS layout) === */
    .top{
      position: relative;
      z-index: 60;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;

      /* this is the key “overlap” behavior you see in EVENTS */
      margin-bottom: -80px;
    }

    .title{
      /* EVENTS uses table alignment for the title */
      padding-left: var(--table-start) !important;

      font-family: 'Fixture', Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
      font-size: 72px;              /* DO NOT change: this is what becomes “huge” under initial-scale=0.32 */
      letter-spacing: -0.04em;
      font-weight: 900;
      color: var(--green);
      margin: 0;
      text-transform: uppercase;
      line-height: 0.86;            /* tighter like EVENTS */
      white-space: nowrap;
    }

    /* ANY logo (top right) */
    .any-logo{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 120px;
      height: 72px;
      margin-right: 8px;
    }
    .any-logo img{
      width: 100%;
      height: auto;
      display: block;
    }

    /* === STICKY GREEN BAR (match EVENTS) === */
    .sticky-head{
      position: sticky;
      top: 0;
      z-index: 40;
      background: var(--green);
      box-shadow: 0 4px 10px rgba(0,0,0,0.10);
      padding: 12px 0;
    }

    .head-inner{
      position: relative;
      max-width: 100%;
      margin: 0 auto;
      padding: 0 28px;

      display: flex;
      align-items: center;
      gap: 16px;
    }

    /* === Search pill (match EVENTS sizing) === */
    .head-search{
      margin-left: calc(var(--table-start) - 28px);
      flex: 0 0 auto;
    }

    .head-search-box{
      display:flex;
      align-items:center;
      gap:6px;
      height:28px;
      padding:0 10px;
      border-radius:999px;
      background:#ffffff;
      border:1px solid rgba(0,0,0,0.16);
      box-shadow:0 2px 10px rgba(0,0,0,0.10);
      max-width:290px;
      width:min(290px, 44vw);
    }

    .head-search-icon{
      width:16px;height:16px;opacity:0.65;flex:0 0 auto;
      display:inline-flex;align-items:center;justify-content:center;
    }
    .head-search-icon svg{ width:16px;height:16px; fill: rgba(0,0,0,0.55); }

    #nlSearch{
      width:100%;
      border:0;
      outline:none;
      background:transparent;
      color:#1f2a1f;
      font-size:12px;
      line-height:1;
    }
    #nlSearch::placeholder{ color: rgba(0,0,0,0.45); }

    .head-search-clear{
      width: 22px;
      height: 22px;
      border: 0;
      background: transparent;
      color: rgba(0,0,0,0.6);
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    /* === Pills group (visual-only for now; you can wire later) === */
    .pill-row{
      flex: 1 1 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding-right: 16px;
    }

    .pill{
      height:28px;
      display:inline-flex;
      align-items:center;
      justify-content: space-between;
      gap:8px;
      padding:0 12px;
      border-radius:999px;
      background:#ffffff;
      border:1px solid rgba(0,0,0,0.16);
      box-shadow:0 2px 10px rgba(0,0,0,0.10);
      font-size:12px;
      color: rgba(0,0,0,0.6);
      min-width: 110px;
      user-select: none;
      cursor: default;
    }
    .pill .caret{
      opacity: 0.7;
      font-size: 10px;
      transform: translateY(1px);
    }

    /* === TABLE === */
    .table-wrap{
      max-width: 100%;
      padding: 18px 28px 40px;
    }
    table{
      width: 100%;
      border-collapse: collapse;
      background: #f0f0f0;
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
    }
    thead th{
      text-align: left;
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(0,0,0,0.55);
      padding: 12px 14px;
      border-bottom: 1px solid rgba(0,0,0,0.10);
      background: #ededed;
    }
    tbody td{
      padding: 14px;
      border-top: 1px solid rgba(0,0,0,0.10);
      vertical-align: top;
      background: #e9e9e9;
    }

    .stack{
      display:flex;
      flex-direction:column;
      line-height:1.15;
      gap: 3px;
    }
    .primary{
      font-weight: 700;
      font-size: 13px;
      color:#111;
    }
    .secondary{
      font-size: 11px;
      color: rgba(0,0,0,0.55);
    }

    .satSunRow{
      display:flex;
      align-items:flex-start;
      gap: 10px;
    }
    .dayLabelCol{
      width: 34px;
      flex: 0 0 34px;
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .dayLabel{
      font-weight: 800;
      color:#111;
      font-size: 13px;
    }
    .timeCol{
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .timeVal{
      font-weight: 600;
      color: rgba(0,0,0,0.55);
      font-size: 13px;
      min-height: 16px;
    }

    .otaCell{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 10px;
      padding-top: 6px;
    }
    .otaLabel{
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(0,0,0,0.55);
      font-weight: 800;
    }
    .dot{
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #bdbdbd;
      border: 1px solid rgba(0,0,0,0.18);
    }
    .dot.y{ background: #19b56b; border-color: rgba(0,0,0,0.10); }
    .dot.n{ background: #d84b4b; border-color: rgba(0,0,0,0.10); }

    .error{
      color:#b40000;
      font-weight: 700;
      padding: 12px 14px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <h1 class="title">DIRECTORY5</h1>

      <!-- ANY logo (same position as EVENTS screenshot) -->
      <div class="any-logo" aria-label="ANY logo">
        <!-- If you already have your own logo asset path, replace the src with it. -->
        <img
          alt="ANY"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 240 140'%3E%3Crect x='8' y='12' width='224' height='116' rx='34' ry='34' fill='none' stroke='%23234c31' stroke-width='6'/%3E%3Ctext x='120' y='92' text-anchor='middle' font-family='Fixture, Impact, Arial Narrow, sans-serif' font-size='72' font-weight='900' fill='%23234c31'%3EANY%3C/text%3E%3C/svg%3E"
        />
      </div>
    </div>
  </div>

  <div class="sticky-head">
    <div class="head-inner">
      <div class="head-search">
        <div class="head-search-box">
          <span class="head-search-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M10 18a8 8 0 1 1 5.293-14.02A8 8 0 0 1 10 18Zm11.707 2.293-5.386-5.386a9.5 9.5 0 1 0-1.414 1.414l5.386 5.386a1 1 0 0 0 1.414-1.414Z"/></svg>
          </span>
          <input id="nlSearch" type="text" placeholder='Filter (e.g., "boston", "ma", "10:00 AM")' />
          <button class="head-search-clear" id="clearBtn" aria-label="Clear">×</button>
        </div>
      </div>

      <div class="pill-row" aria-hidden="true">
        <div class="pill">Events <span class="caret">▼</span></div>
        <div class="pill">Years <span class="caret">▼</span></div>
        <div class="pill">States <span class="caret">▼</span></div>
      </div>
    </div>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th style="width: 44%;">NAME / IG</th>
          <th style="width: 22%;">CITY / STATE</th>
          <th style="width: 22%;">SAT / SUN</th>
          <th style="width: 12%;">OTA</th>
        </tr>
      </thead>
      <tbody id="rowsBody">
        <tr><td class="error" colspan="4">Loading…</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    const CSV_PATH = "data/directory.csv"; // keep your git path
    const rowsBody = document.getElementById("rowsBody");
    const nlSearch = document.getElementById("nlSearch");
    const clearBtn = document.getElementById("clearBtn");

    function toProper(str){
      const s = (str ?? "").toString().trim();
      if(!s) return "";
      return s
        .toLowerCase()
        .split(/(\s+|[-/])/g)
        .map(part => {
          if (part.trim() === "" || part === "-" || part === "/") return part;
          return part.charAt(0).toUpperCase() + part.slice(1);
        })
        .join("");
    }

    function toLowerSafe(str){
      return (str ?? "").toString().trim().toLowerCase();
    }

    function normalizeTime(t){
      const raw = (t ?? "").toString().trim();
      if(!raw) return "";
      const up = raw.replace(/\s+/g, " ").trim().toUpperCase();

      // Accept already formatted "H:MM AM/PM"
      if (/^\d{1,2}:\d{2}\s?(AM|PM)$/.test(up)) return up.replace(" ", " ");

      // Accept "H AM" / "HPM" / "H:MMam"
      const m = up.match(/^(\d{1,2})(?::(\d{2}))?\s*(A|P)M?$/);
      if(!m) return up;

      let hh = parseInt(m[1], 10);
      let mm = m[2] ? parseInt(m[2], 10) : 0;
      const ap = m[3] === "A" ? "AM" : "PM";

      if (Number.isNaN(hh) || hh < 1 || hh > 12) return up;
      if (Number.isNaN(mm) || mm < 0 || mm > 59) mm = 0;

      const mmStr = String(mm).padStart(2, "0");
      return `${hh}:${mmStr} ${ap}`;
    }

    function normalizeDate(d){
      const raw = (d ?? "").toString().trim();
      if(!raw) return "";
      // Expect MM/DD/YYYY already; keep if valid-ish
      if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(raw)) {
        const [m, day, y] = raw.split("/").map(x => x.padStart(2, "0"));
        return `${m}/${day}/${y}`;
      }
      return raw;
    }

    function parseCSV(text){
      // Simple CSV parser with quotes support
      const rows = [];
      let cur = [];
      let val = "";
      let inQuotes = false;

      for (let i = 0; i < text.length; i++){
        const ch = text[i];
        const next = text[i+1];

        if (ch === '"' ){
          if (inQuotes && next === '"'){ val += '"'; i++; }
          else inQuotes = !inQuotes;
          continue;
        }

        if (!inQuotes && (ch === "," || ch === "\n" || ch === "\r")){
          if (ch === "\r" && next === "\n"){ /* windows newline */ }
          cur.push(val);
          val = "";

          if (ch === "\n" || ch === "\r"){
            if (cur.length > 1 || cur.some(c => (c ?? "").trim() !== "")) rows.push(cur);
            cur = [];
          }
          continue;
        }

        val += ch;
      }
      cur.push(val);
      rows.push(cur);
      return rows;
    }

    let allRows = [];
    function render(rows){
      if(!rows.length){
        rowsBody.innerHTML = `<tr><td class="error" colspan="4">No rows found.</td></tr>`;
        return;
      }

      rowsBody.innerHTML = rows.map(r => {
        const name = toProper(r.NAME);
        const ig = toLowerSafe(r.IG);
        const city = toProper(r.CITY);
        const state = toProper(r.STATE);

        const sat = normalizeTime(r.SAT);
        const sun = normalizeTime(r.SUN);

        const ota = (r.OTA ?? "").toString().trim().toUpperCase(); // Y / N / blank
        const dotClass = ota === "Y" ? "y" : (ota === "N" ? "n" : "");

        return `
          <tr>
            <td>
              <div class="stack">
                <div class="primary">${escapeHTML(name)}</div>
                <div class="secondary">${escapeHTML(ig)}</div>
              </div>
            </td>
            <td>
              <div class="stack">
                <div class="primary">${escapeHTML(city)}</div>
                <div class="secondary">${escapeHTML(state)}</div>
              </div>
            </td>
            <td>
              <div class="satSunRow">
                <div class="dayLabelCol">
                  <div class="dayLabel">Sat.</div>
                  <div class="dayLabel">Sun.</div>
                </div>
                <div class="timeCol">
                  <div class="timeVal">${escapeHTML(sat)}</div>
                  <div class="timeVal">${escapeHTML(sun)}</div>
                </div>
              </div>
            </td>
            <td>
              <div class="otaCell">
                <div class="otaLabel">OTA</div>
                <div class="dot ${dotClass}"></div>
              </div>
            </td>
          </tr>
        `;
      }).join("");
    }

    function escapeHTML(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function applySearch(){
      const q = (nlSearch.value ?? "").toString().trim().toLowerCase();
      if(!q){ render(allRows); return; }

      const filtered = allRows.filter(r => {
        const blob = [
          r.STATE, r.CITY, r.NAME, r.IG, r.SAT, r.SUN, r.OTA, r.CREATED
        ].map(x => (x ?? "").toString().toLowerCase()).join(" ");
        return blob.includes(q);
      });
      render(filtered);
    }

    clearBtn.addEventListener("click", () => {
      nlSearch.value = "";
      applySearch();
      nlSearch.focus();
    });

    nlSearch.addEventListener("input", applySearch);

    (async function init(){
      try{
        const res = await fetch(CSV_PATH, { cache: "no-store" });
        if(!res.ok) throw new Error(`Failed to load ${CSV_PATH} (${res.status})`);
        const text = await res.text();

        const parsed = parseCSV(text);
        const header = parsed.shift().map(h => (h ?? "").toString().trim().toUpperCase());

        const idx = (name) => header.indexOf(name);

        allRows = parsed
          .map(cols => {
            const get = (h) => {
              const i = idx(h);
              return i >= 0 ? (cols[i] ?? "").toString().trim() : "";
            };
            return {
              STATE: get("STATE"),
              CITY: get("CITY"),
              NAME: get("NAME"),
              IG: get("IG"),
              SAT: get("SAT"),
              SUN: get("SUN"),
              OTA: get("OTA"),
              CREATED: get("CREATED")
            };
          });

        render(allRows);
      }catch(err){
        rowsBody.innerHTML = `<tr><td class="error" colspan="4">${escapeHTML(err.message)}</td></tr>`;
      }
    })();
  </script>
</body>
</html>
