<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DIRECTORY 8</title>

  <style>
    :root{
      --bg: #e9e9e9;
      --green: #1f4e35;
      --pill: #ffffff;
      --pill-border: rgba(0,0,0,.18);
      --text: #111;
      --muted: rgba(0,0,0,.55);
      --gridline: rgba(0,0,0,.12);
      --ota-yes: #1fb86a;
      --ota-no: #d24b4b;
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    /* =========================
       TITLE STRIP (MATCH EVENTS)
       ========================= */
    .top-title{
      width: 100%;
      position: relative;
      overflow: hidden;            /* enables the left-crop feel */
      background: var(--bg);
      padding: 10px 0 0 0;
    }

    /* This inner matches the same left gutter the green bar uses */
    .title-inner{
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 18px;
      position: relative;
      min-height: 120px;
      display:flex;
      align-items:flex-end;
    }

    /* The big word */
    .title-inner h1{
      margin: 0;
      color: var(--green);
      font-weight: 900;
      line-height: .78;            /* tight like EVENTS */
      letter-spacing: -4px;
      font-size: clamp(92px, 12vw, 175px);

      font-family: "Impact","Arial Narrow","Haettenschweiler","Anton",system-ui,sans-serif;

      display:inline-block;

      /* MORE condensed than before (this is the missing “EVENTS” feel) */
      transform: scaleX(0.70);

      /* This is the subtle “crop into the left edge” trick */
      transform-origin: left bottom;
      position: relative;
      left: -18px;                 /* pushes into the gutter like EVENTS */
    }

    /* ANY logo should NOT affect title width/position */
    .any-mark{
      position: absolute;
      right: 22px;
      top: 30px;
      display:flex;
      align-items:center;
      justify-content:center;
      height: 70px;
      width: 110px;
      border: 3px solid var(--green);
      border-radius: 999px;
      color: var(--green);
      font-weight: 900;
      font-family: "Impact", "Arial Black", "Anton", system-ui, sans-serif;
      font-size: 44px;
      line-height: 1;
      background: transparent;
      pointer-events: none;
    }

    /* ===== Green bar with pills ===== */
    .sticky-bar{
      position: sticky;
      top: 0;
      z-index: 50;
      background: var(--green);
      padding: 14px 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,.18);
    }
    .bar-inner{
      max-width: 1100px;
      margin: 0 auto;
      display:flex;
      align-items:center;
      gap: 16px;
    }

    .search-pill{
      flex: 1 1 520px;
      height: 44px;
      border-radius: 999px;
      background: var(--pill);
      border: 1px solid var(--pill-border);
      box-shadow: 0 1px 0 rgba(0,0,0,.10);
      display:flex;
      align-items:center;
      padding: 0 12px;
      gap: 10px;
    }
    .search-icon{
      width: 18px;
      height: 18px;
      opacity: .55;
      flex: 0 0 auto;
    }
    .search-input{
      width: 100%;
      border: 0;
      outline: none;
      font-size: 18px;
      background: transparent;
      color: #222;
    }
    .search-clear{
      border:0;
      background: transparent;
      font-size: 26px;
      line-height: 1;
      padding: 0 6px;
      cursor: pointer;
      opacity: .55;
    }
    .search-clear:hover{ opacity: .8; }

    .pill-group{
      flex: 0 0 auto;
      display:flex;
      align-items:center;
      gap: 14px;
    }
    .filter-pill{
      height: 44px;
      min-width: 190px;
      padding: 0 18px;
      border-radius: 999px;
      background: var(--pill);
      border: 1px solid var(--pill-border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      box-shadow: 0 1px 0 rgba(0,0,0,.10);
      user-select:none;
      cursor: default;
    }
    .filter-pill span{
      font-size: 20px;
      color: rgba(0,0,0,.45);
      font-weight: 600;
    }
    .caret{
      font-size: 18px;
      color: rgba(0,0,0,.35);
      transform: translateY(1px);
    }

    /* ===== Table area ===== */
    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px;
    }
    .table{
      width: 100%;
      border-collapse: collapse;
      background: rgba(255,255,255,.20);
    }
    .table thead th{
      text-align:left;
      font-size: 14px;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: rgba(0,0,0,.55);
      padding: 10px 12px;
      border-bottom: 1px solid var(--gridline);
    }
    .table tbody td{
      padding: 0;
      border-bottom: 1px solid var(--gridline);
    }

    .row-grid{
      display:grid;
      grid-template-columns: 1.25fr 1.15fr 0.9fr 90px;
      align-items: stretch;
      min-height: 74px;
      background: rgba(255,255,255,.12);
    }
    .cell{
      padding: 12px 12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 4px;
      border-right: 1px solid var(--gridline);
    }
    .cell:last-child{ border-right: 0; }

    .topline{
      font-weight: 800;
      font-size: 18px;
      line-height: 1.05;
      color: #111;
    }
    .botline{
      font-size: 16px;
      line-height: 1.05;
      color: rgba(0,0,0,.55);
    }

    .times{ gap: 6px; }
    .time-row{
      display:flex;
      align-items:baseline;
      gap: 10px;
      line-height: 1.05;
    }
    .time-label{
      width: 42px;
      font-weight: 900;
      font-size: 18px;
      color: #111;
    }
    .time-val{
      font-size: 18px;
      color: rgba(0,0,0,.55);
      font-weight: 700;
    }

    .ota-wrap{
      align-items:center;
      justify-content:center;
      gap: 10px;
    }
    .ota-label{
      font-weight: 900;
      font-size: 14px;
      letter-spacing: .08em;
      color: rgba(0,0,0,.55);
      text-transform: uppercase;
    }
    .ota-dot{
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: rgba(0,0,0,.20);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.12);
    }
    .ota-yes{ background: var(--ota-yes); box-shadow:none; }
    .ota-no{ background: var(--ota-no); box-shadow:none; }

    @media (max-width: 900px){
      .pill-group{ display:none; }
      .title-inner{ min-height: 96px; }
      .any-mark{ height: 56px; width: 90px; font-size: 38px; top: 22px; right: 18px; }
      .title-inner h1{ font-size: clamp(76px, 14vw, 140px); left: -14px; transform: scaleX(0.72); }
    }
  </style>
</head>

<body>

  <!-- Title strip -->
  <div class="top-title">
    <div class="title-inner">
      <!-- Keep your commit marker in the word if you want: DIRECTORY3 -->
      <h1>DIRECTORY3</h1>
      <div class="any-mark">(ANY)</div>
    </div>
  </div>

  <!-- Green bar -->
  <div class="sticky-bar">
    <div class="bar-inner">

      <div class="search-pill" role="search">
        <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M10 18a8 8 0 1 1 5.292-14.001A8 8 0 0 1 10 18Zm11.707 2.293-5.4-5.4a10 10 0 1 0-1.414 1.414l5.4 5.4a1 1 0 0 0 1.414-1.414Z"/>
        </svg>
        <input id="searchInput" class="search-input" type="text" autocomplete="off" spellcheck="false"
               placeholder='Filter (e.g., "boston", "ma", "10:00 AM")' />
        <button id="searchClear" class="search-clear" type="button" aria-label="Clear filter" title="Clear">×</button>
      </div>

      <div class="pill-group" aria-hidden="true">
        <div class="filter-pill"><span>Events</span><span class="caret">▾</span></div>
        <div class="filter-pill" style="min-width:170px;"><span>Years</span><span class="caret">▾</span></div>
        <div class="filter-pill" style="min-width:170px;"><span>States</span><span class="caret">▾</span></div>
      </div>

    </div>
  </div>

  <!-- Table -->
  <div class="wrap">
    <table class="table" aria-label="Gym Directory">
      <thead>
        <tr>
          <th style="width:50%;">Name / IG</th>
          <th style="width:25%;">City / State</th>
          <th style="width:20%;">Sat / Sun</th>
          <th style="width:5%;">OTA</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

<script>
  // ===== Formatting helpers =====
  function toProper(s){
    s = (s ?? "").toString().trim();
    if(!s) return "";
    return s
      .toLowerCase()
      .split(/\s+/)
      .map(w => w ? (w[0].toUpperCase() + w.slice(1)) : "")
      .join(" ");
  }
  function toLower(s){ return (s ?? "").toString().trim().toLowerCase(); }

  function formatTime(s){
    s = (s ?? "").toString().trim();
    if(!s) return "";
    const raw = s.replace(/\./g,"").replace(/\s+/g," ").trim();

    const ampmMatch =
      raw.match(/^(\d{1,2})(?::(\d{2}))?\s*(a|p|am|pm)$/i) ||
      raw.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)$/i) ||
      raw.match(/^(\d{1,2})(?::(\d{2}))?\s*(a|p)$/i);

    if (ampmMatch){
      let h = parseInt(ampmMatch[1], 10);
      let m = parseInt(ampmMatch[2] || "00", 10);
      const apRaw = (ampmMatch[3] || "").toLowerCase();
      const ap = (apRaw === "a" ? "AM" : apRaw === "p" ? "PM" : apRaw.toUpperCase());
      if (h === 0) h = 12;
      if (h > 12) h = ((h - 1) % 12) + 1;
      return `${h}:${String(m).padStart(2,"0")} ${ap}`;
    }

    const h24 = raw.match(/^(\d{1,2}):(\d{2})$/);
    if (h24){
      let h = parseInt(h24[1], 10);
      let m = parseInt(h24[2], 10);
      if (h >= 0 && h <= 23 && m >= 0 && m <= 59){
        const ap = h >= 12 ? "PM" : "AM";
        h = h % 12; if (h === 0) h = 12;
        return `${h}:${String(m).padStart(2,"0")} ${ap}`;
      }
    }

    const justHour = raw.match(/^(\d{1,2})$/);
    if (justHour){
      let h = parseInt(justHour[1], 10);
      if (h >= 1 && h <= 12) return `${h}:00 AM`;
      if (h >= 13 && h <= 23){
        const ap = "PM";
        h = h % 12;
        return `${h}:00 ${ap}`;
      }
    }

    const hhmm = raw.match(/^(\d{1,2}):(\d{2})$/);
    if (hhmm){
      let h = parseInt(hhmm[1], 10);
      let m = parseInt(hhmm[2], 10);
      if (h >= 1 && h <= 12 && m >= 0 && m <= 59) return `${h}:${String(m).padStart(2,"0")} AM`;
    }

    return raw;
  }

  // ===== CSV parsing =====
  function parseCSV(text){
    const rows = [];
    let cur = "", inQuotes = false;
    const out = [];
    const pushCell = () => { out.push(cur); cur = ""; };
    const pushRow = () => { rows.push(out.splice(0)); };

    for(let i=0;i<text.length;i++){
      const c = text[i];
      if(c === '"'){
        if(inQuotes && text[i+1] === '"'){ cur += '"'; i++; }
        else inQuotes = !inQuotes;
      } else if(c === "," && !inQuotes){
        pushCell();
      } else if((c === "\n" || c === "\r") && !inQuotes){
        if(c === "\r" && text[i+1] === "\n") i++;
        pushCell(); pushRow();
      } else {
        cur += c;
      }
    }
    if(cur.length || out.length){ pushCell(); pushRow(); }
    return rows.filter(r => r.some(v => (v ?? "").toString().trim() !== ""));
  }

  function makeRow(rec){
    const name  = toProper(rec.NAME);
    const ig    = toLower(rec.IG);
    const city  = toProper(rec.CITY);
    const state = toProper(rec.STATE);
    const sat   = formatTime(rec.SAT);
    const sun   = formatTime(rec.SUN);
    const otaRaw = (rec.OTA ?? "").toString().trim().toUpperCase();

    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 4;

    const grid = document.createElement("div");
    grid.className = "row-grid";

    const c1 = document.createElement("div");
    c1.className = "cell";
    c1.innerHTML = `
      <div class="topline">${name || "—"}</div>
      <div class="botline">${ig || "—"}</div>
    `;

    const c2 = document.createElement("div");
    c2.className = "cell";
    c2.innerHTML = `
      <div class="topline">${city || "—"}</div>
      <div class="botline">${state || "—"}</div>
    `;

    const c3 = document.createElement("div");
    c3.className = "cell times";
    c3.innerHTML = `
      <div class="time-row">
        <div class="time-label">Sat.</div>
        <div class="time-val">${sat || ""}</div>
      </div>
      <div class="time-row">
        <div class="time-label">Sun.</div>
        <div class="time-val">${sun || ""}</div>
      </div>
    `;

    const c4 = document.createElement("div");
    c4.className = "cell ota-wrap";
    c4.innerHTML = `<div class="ota-label">OTA</div>`;
    const dot = document.createElement("div");
    dot.className = "ota-dot";
    if (otaRaw === "Y") dot.classList.add("ota-yes");
    else if (otaRaw === "N") dot.classList.add("ota-no");
    c4.appendChild(dot);

    grid.appendChild(c1);
    grid.appendChild(c2);
    grid.appendChild(c3);
    grid.appendChild(c4);

    td.appendChild(grid);
    tr.appendChild(td);
    return tr;
  }

  // ===== Load + render (robust paths) =====
  const tbody = document.getElementById("tbody");
  let allRecords = [];

  async function fetchFirst(urls){
    let lastErr = null;
    for(const u of urls){
      try{
        const res = await fetch(u, { cache: "no-store" });
        if(!res.ok) throw new Error(`HTTP ${res.status} (${u})`);
        const txt = await res.text();
        if(txt.trim()) return txt;
      }catch(e){ lastErr = e; }
    }
    throw lastErr || new Error("Failed to load CSV");
  }

  async function loadDirectory(){
    const text = await fetchFirst([
      "data/directory.csv",
      "./data/directory.csv",
      "/data/directory.csv"
    ]);

    const rows = parseCSV(text);
    const header = rows.shift().map(h => (h ?? "").toString().trim().toUpperCase());

    allRecords = rows.map(r => {
      const obj = {};
      header.forEach((h, i) => obj[h] = (r[i] ?? "").toString().trim());
      return {
        STATE: obj.STATE ?? "",
        CITY: obj.CITY ?? "",
        NAME: obj.NAME ?? "",
        IG: obj.IG ?? "",
        SAT: obj.SAT ?? "",
        SUN: obj.SUN ?? "",
        OTA: obj.OTA ?? ""
      };
    });

    render(allRecords);
  }

  function render(list){
    tbody.innerHTML = "";
    list.forEach(rec => tbody.appendChild(makeRow(rec)));
  }

  // ===== Filter =====
  const searchInput = document.getElementById("searchInput");
  const searchClear = document.getElementById("searchClear");

  function applyFilter(){
    const q = searchInput.value.trim().toLowerCase();
    if(!q){ render(allRecords); return; }
    const filtered = allRecords.filter(r => {
      const hay = [r.STATE, r.CITY, r.NAME, r.IG, r.SAT, r.SUN, r.OTA].join(" ").toLowerCase();
      return hay.includes(q);
    });
    render(filtered);
  }

  searchInput.addEventListener("input", applyFilter);
  searchClear.addEventListener("click", () => {
    searchInput.value = "";
    applyFilter();
    searchInput.focus();
  });

  loadDirectory().catch(err => {
    console.error(err);
    tbody.innerHTML = `<tr><td style="padding:16px;color:#a00;font-weight:700;">${err.message}</td></tr>`;
  });
</script>

</body>
</html>
